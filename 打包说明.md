# 桌面小组件系统 - 打包说明

## 概述

本项目提供完整的Windows EXE安装程序制作方案，包括：
- 自动编译Release版本
- Qt依赖库打包
- 专业安装程序制作
- 便携版和安装版两种分发方式

## 前提条件

### 必需软件

1. **Qt 6.9.0** (或更高版本)
   - 下载地址：https://www.qt.io/download
   - 需要MinGW编译器

2. **CMake**
   - 通常随Qt安装
   - 或从 https://cmake.org/ 单独下载

3. **NSIS (Nullsoft Scriptable Install System)**
   - 下载地址：https://nsis.sourceforge.io/
   - 用于创建Windows安装程序

### 可选软件

- **图标编辑器** (如IcoFX、Greenfish Icon Editor Pro)
- **图片编辑器** (用于制作安装程序界面图片)

## 快速开始

### 方法一：一键打包 (推荐)

1. **首先修复编译错误**
   ```batch
   # 确保项目能正常编译
   cd /path/to/your/project
   ```

2. **运行一键打包脚本**
   ```batch
   create_complete_installer.bat
   ```

3. **等待完成**
   - 脚本会自动完成所有步骤
   - 最终生成 `DesktopWidgetSystem_Setup.exe`

### 方法二：分步打包

如果一键脚本遇到问题，可以分步执行：

1. **编译Release版本**
   ```batch
   # 在Qt Creator中切换到Release模式编译
   # 或使用命令行：
   mkdir build && cd build
   cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release
   cmake --build . --config Release
   ```

2. **部署Qt依赖**
   ```batch
   deploy_qtcreator.bat
   ```

3. **创建安装程序**
   ```batch
   create_installer.bat
   ```

## 配置说明

### 修改路径配置

编辑脚本中的路径变量，根据你的环境修改：

```batch
# 在 create_complete_installer.bat 中修改这些路径
set "QT_DIR=C:\Qt\6.9.0\mingw_64"                    # Qt安装路径
set "CMAKE_DIR=C:\Qt\Tools\CMake_64\bin"             # CMake路径
set "MINGW_DIR=C:\Qt\Tools\mingw1310_64\bin"         # MinGW路径
set "NSIS_DIR=C:\Program Files (x86)\NSIS"           # NSIS安装路径
```

### 自定义应用信息

在 `installer_enhanced.nsi` 中修改：

```nsis
!define APP_NAME "桌面小组件系统"           # 应用名称
!define APP_VERSION "1.0.0"               # 版本号
!define APP_PUBLISHER "Widget Studio"     # 发布者
```

## 高级配置

### 添加应用图标

1. **创建ICO文件**
   - 准备PNG格式图标 (推荐256x256)
   - 转换为ICO格式
   - 命名为 `icon.ico` 放在项目根目录

2. **安装程序界面图片** (可选)
   - `header.bmp`: 150x57像素，安装程序顶部横幅
   - `welcome.bmp`: 164x314像素，欢迎页面侧边图

### 自定义安装选项

编辑 `installer_enhanced.nsi` 可以：
- 修改默认安装路径
- 添加/删除安装组件
- 自定义安装步骤
- 修改界面文本

### 数字签名 (可选)

为了提高安装程序的可信度：

1. **获取代码签名证书**
2. **使用signtool.exe签名**
   ```batch
   signtool sign /f "certificate.pfx" /p "password" /t "http://timestamp.digicert.com" "DesktopWidgetSystem_Setup.exe"
   ```

## 输出文件

成功打包后会生成：

### 安装程序版本
- `DesktopWidgetSystem_Setup.exe` - Windows安装程序
  - 包含完整的安装/卸载功能
  - 自动创建开始菜单和桌面快捷方式
  - 支持升级安装

### 便携版
- `deploy/` 目录 - 绿色便携版
  - 可直接复制到任何Windows电脑运行
  - 无需安装，适合测试和临时使用

## 常见问题

### Q: 编译失败怎么办？
A: 检查以下项目：
- Qt和MinGW版本匹配
- 中文注释编码问题
- 依赖库是否完整

### Q: windeployqt运行失败
A: 确保：
- Qt bin目录在PATH中
- exe文件编译成功
- 使用正确的Qt版本

### Q: NSIS安装程序创建失败
A: 检查：
- NSIS是否正确安装
- `deploy/` 目录是否存在且包含exe文件
- `LICENSE.txt` 文件是否存在

### Q: 生成的安装程序过大
A: 可以优化：
- 使用 `--no-translations` 排除翻译文件
- 移除不需要的Qt模块
- 压缩资源文件

## 分发建议

### 测试步骤
1. 在开发机器上测试便携版
2. 在虚拟机或其他电脑上测试安装程序
3. 测试卸载功能
4. 验证开机自启等功能

### 发布清单
- [ ] 程序功能完整测试
- [ ] 安装/卸载测试
- [ ] 多系统兼容性测试
- [ ] 病毒扫描检查
- [ ] 用户文档准备

## 技术支持

如果遇到问题：
1. 检查错误日志
2. 确认环境配置
3. 查看本文档常见问题
4. 联系开发团队

---

**注意：** 首次打包建议先在测试环境中验证，确保所有功能正常后再发布正式版本。 